# 記憶池 (Mempool)

### 記憶池 (Mempool)

**Mempool（記憶池）** 是 **未確認比特幣交易的臨時儲存空間**。它存在於 **每個比特幣完整節點內**，而不是作為單一資料庫。

✅ 每個完整節點都有 **自己的記憶池**，其中包含待處理的交易。  
✅ 交易會留在記憶池中，**直到礦工將它們包含在區塊中**。  
✅ 一旦交易被 **礦工挖入區塊**，它會 **從所有記憶池中移除**。

### **Mempool 是資料庫嗎？**  
🔹 **不，記憶池不是全球資料庫。**  
🔹 每個比特幣節點將交易儲存在 **RAM（記憶體）** 中。  
🔹 不同的節點可能會因為網路延遲、交易費用和本地設置等原因而有 **稍微不同的記憶池**。

---

### **交易如何進入並儲存在記憶池中？**  
#### **1️⃣ 用戶創建交易**
- 一個比特幣錢包（如 Electrum、Ledger 或 Bitcoin Core）會生成一筆 **交易**。  
- 交易包含：  
  - 輸入（被花費的先前 UTXO）  
  - 輸出（接收者地址 + 金額）  
  - 數位簽名（證明比特幣的所有權）  
  - **交易費用**（礦工的激勳）  

#### **2️⃣ 交易廣播到網絡**
- 錢包將交易 **發送** 到一個比特幣 **完整節點**（通過點對點網絡）。  
- 節點 **驗證** 該交易：  
  ✅ 輸入是否 **未被花費**？  
  ✅ 簽名是否與發送者的私鑰匹配？  
  ✅ 發送者是否擁有足夠的比特幣？  
  ✅ 交易結構是否有效？

#### **3️⃣ 交易進入記憶池**
- 如果交易有效，節點會 **儲存** 該交易於其 **記憶池** 中。  
- 節點會 **廣播** 該交易到 **其他完整節點**。  
- 其他節點會重複這個過程並更新它們的記憶池。

#### **4️⃣ 礦工從記憶池中選擇交易**
- 礦工從他們 **自己的記憶池** 中選擇交易，優先選擇 **高費用交易**。  
- 選中的交易會組成一個 **新的候選區塊**。  
- 礦工嘗試 **找到有效的隨機數**，以解決工作量證明（PoW）。

#### **5️⃣ 交易被確認並從記憶池中移除**
- 一旦礦工找到有效的哈希，區塊會被 **廣播** 到網絡中。  
- 完整節點會 **驗證** 該區塊並將其加入區塊鏈。  
- 區塊中的交易會 **從所有記憶池中移除**。

___

### **如果所有記憶池都滿了，會發生什麼事？**  
如果所有記憶池達到 **最大容量**：  
1️⃣ **最低費用的交易會被丟棄**（不會儲存到記憶池中）。  
2️⃣ 這些交易 **不會被包含在任何區塊** 中，除非重新廣播並附上更高的費用。  
3️⃣ 用戶可以使用 **Replace-By-Fee（RBF）** 重新發送交易並附上更高的費用。

💡 **範例情境**：  
- 一個節點的記憶池限制為 **300 MB**。  
- 如果記憶池滿了，新的 **低費用交易** 會被 **拒絕**。  
- 高費用交易仍然會被 **接受**。

### **如何避免交易被丟棄？**  
✅ 用戶可以在發送前 **增加交易費用**。  
✅ 使用 **RBF（Replace-By-Fee）** 來將低費用交易替換為高費用交易。  
✅ 等待 **記憶池擁塞解除**（當礦工處理待處理交易時）。

---

### **如果長時間沒有交易或所有交易都已被挖掘會怎麼樣？**  
如果 **很少或根本沒有交易** 持續很長一段時間：  
✅ 礦工仍會繼續挖掘 **空區塊** 來領取區塊獎勳。  
✅ 比特幣的 **挖礦難度會下降**，使挖礦變得更容易。  
✅ 網絡仍然保持運行，但區塊大多會是空的。

🔴 **但：** 如果沒有礦工存在，比特幣就會停止運作（不會有新區塊產生）。

