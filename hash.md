# Hash Function

## SHA-256

### **ä»€éº¼æ˜¯ SHA-256ï¼Ÿ**  
SHA-256ï¼ˆå®‰å…¨é›œæ¹Šç®—æ³• 256 ä½ï¼‰æ˜¯ä¸€ç¨®åŠ å¯†é›œæ¹Šå‡½æ•¸ï¼Œå®ƒæŽ¥æ”¶è¼¸å…¥ä¸¦ç”¢ç”Ÿå›ºå®šé•·åº¦çš„ 256 ä½ï¼ˆ32 å­—ç¯€ï¼‰é›œæ¹Šå€¼ã€‚å®ƒæ˜¯ **SHA-2** å®¶æ—ä¸­çš„ä¸€å“¡ï¼Œç”± **ç¾Žåœ‹åœ‹å®¶å®‰å…¨å±€ï¼ˆNSAï¼‰** é–‹ç™¼ï¼Œä¸¦ç”± **ç¾Žåœ‹åœ‹å®¶æ¨™æº–èˆ‡æŠ€è¡“ç ”ç©¶æ‰€ï¼ˆNISTï¼‰** ç™¼ä½ˆã€‚

#### **SHA-256 çš„ä¸»è¦ç‰¹æ€§**  
1. **å›ºå®šé•·åº¦è¼¸å‡ºï¼š** ç„¡è«–è¼¸å…¥å¤§å°å¦‚ä½•ï¼ŒSHA-256 å§‹çµ‚æœƒç”¢ç”Ÿ **256 ä½ï¼ˆ64 å­—ç¬¦åå…­é€²åˆ¶ï¼‰** çš„é›œæ¹Šã€‚  
2. **ç¢ºå®šæ€§ï¼š** ç›¸åŒçš„è¼¸å…¥ç¸½æ˜¯æœƒç”¢ç”Ÿç›¸åŒçš„è¼¸å‡ºã€‚  
3. **å¿«é€Ÿè¨ˆç®—ï¼š** è¨ˆç®—ä»»ä½•çµ¦å®šè¼¸å…¥çš„é›œæ¹Šéžå¸¸é«˜æ•ˆã€‚  
4. **æŠ—é€†å‘æ€§ï¼š** çµ¦å®šä¸€å€‹é›œæ¹Šå€¼ï¼Œè¨ˆç®—ä¸Šå¹¾ä¹Žä¸å¯èƒ½æ‰¾åˆ°åŽŸå§‹è¼¸å…¥ã€‚  
5. **æŠ—ç¢°æ’žæ€§ï¼š** å¾ˆé›£æ‰¾åˆ°å…©å€‹ä¸åŒçš„è¼¸å…¥ç”¢ç”Ÿç›¸åŒçš„é›œæ¹Šã€‚  
6. **é›ªå´©æ•ˆæ‡‰ï¼š** è¼¸å…¥ä¸­çš„å°è®ŠåŒ–æœƒå°Žè‡´å®Œå…¨ä¸åŒçš„é›œæ¹Šã€‚

---

### **SHA-256 å¦‚ä½•åœ¨æ¯”ç‰¹å¹£ä¸­æ‡‰ç”¨ï¼Ÿ**  
æ¯”ç‰¹å¹£ä½¿ç”¨ SHA-256 é€²è¡Œå¤šå€‹ç”¨é€”ï¼Œä¸»è¦æ˜¯ **å·¥ä½œé‡è­‰æ˜Žï¼ˆæŒ–ç¤¦ï¼‰** å’Œ **åœ°å€ç”Ÿæˆ**ã€‚

#### **1. å·¥ä½œé‡è­‰æ˜Žï¼ˆæŒ–ç¤¦ï¼‰**  
æ¯”ç‰¹å¹£æŒ–ç¤¦ä¾è³´æ–¼ SHA-256 ä¾†é©—è­‰äº¤æ˜“ä¸¦ä¿è­·ç¶²çµ¡ã€‚å…¶å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š  
- ç¤¦å·¥å¿…é ˆé€šéŽæ”¹è®Šä¸€å€‹ç¨±ç‚º **éš¨æ©Ÿæ•¸ï¼ˆnonceï¼‰** çš„æ•¸å­—ä¾†æ‰¾åˆ°ä¸€å€‹ **æœ‰æ•ˆçš„é›œæ¹Š**ï¼ˆæ»¿è¶³æ‰€éœ€çš„é›£åº¦ï¼‰ã€‚  
- æŒ–ç¤¦éŽç¨‹æ¶‰åŠå° **å€å¡Šé ­** é€²è¡Œ **é›™é‡ SHA-256** é›œæ¹Šï¼ˆå³ **SHA-256(SHA-256(å€å¡Šé ­))**ï¼‰ã€‚  
- å¦‚æžœçµæžœçš„é›œæ¹Šå€¼ä½Žæ–¼çµ¦å®šçš„ **ç›®æ¨™å€¼**ï¼Œå‰‡è©²å€å¡Šæœƒè¢«ç¶²çµ¡æŽ¥å—ã€‚

ðŸ”¹ **æŒ–ç¤¦ä¸­ä½¿ç”¨çš„å€å¡Šé ­çµ„ä»¶ï¼š**  
   - å‰å€å¡Šçš„é›œæ¹Š  
   - Merkle æ¨¹æ ¹ï¼ˆæ‰€æœ‰äº¤æ˜“çš„é›œæ¹Šï¼‰  
   - æ™‚é–“æˆ³  
   - éš¨æ©Ÿæ•¸ï¼ˆç¤¦å·¥æ”¹è®Šæ­¤æ•¸å­—ä»¥å°‹æ‰¾æœ‰æ•ˆé›œæ¹Šï¼‰  
   - é›£åº¦ç›®æ¨™  

#### **2. æ¯”ç‰¹å¹£åœ°å€ç”Ÿæˆ**  
SHA-256 ä¹Ÿç”¨æ–¼å‰µå»ºæ¯”ç‰¹å¹£åœ°å€ï¼š  
1. ç”Ÿæˆ **ç§é‘°**ã€‚  
2. ä½¿ç”¨ **æ©¢åœ“æ›²ç·šæ•¸å­—ç°½åç®—æ³•ï¼ˆECDSAï¼‰** å°‡ç§é‘°è½‰æ›ç‚º **å…¬é‘°**ã€‚  
3. å°å…¬é‘°é€²è¡Œé›œæ¹Šè™•ç†ï¼š  
   - **SHA-256**ï¼ˆç”Ÿæˆç¬¬ä¸€æ¬¡é›œæ¹Šï¼‰  
   - **RIPEMD-160**ï¼ˆç¸®çŸ­é›œæ¹Šï¼‰  
4. ä½¿ç”¨ **é›™é‡ SHA-256** æ·»åŠ æª¢æŸ¥ç¢¼ã€‚  
5. å°‡çµæžœè½‰æ›ç‚º **Base58Check ç·¨ç¢¼**ï¼Œç”Ÿæˆæœ€çµ‚çš„æ¯”ç‰¹å¹£åœ°å€ã€‚

---

### **ç¯„ä¾‹ï¼šæ¯”ç‰¹å¹£ä¸­çš„ SHA-256 é›œæ¹Š**  
å¦‚æžœæ‚¨å°å–®è©ž `"Bitcoin"` é€²è¡Œ SHA-256 é›œæ¹Šï¼š

```
SHA-256("Bitcoin") =  6b600a8c9a00850ed1e795e4c45aebd5cb3d10cbcad1d344f291218da5bda115
```

ç¨å¾®æ”¹è®Šè¼¸å…¥æœƒå°Žè‡´é›œæ¹Šç™¼ç”Ÿå·¨å¤§è®ŠåŒ–ï¼š

```
SHA-256("bitcoin") =  6b9b4d6c01f76aa7a8108cb45efb01c32022635c90260b3b30dc5ef190d4362b
```

---

### **ç‚ºä»€éº¼ SHA-256 å°æ¯”ç‰¹å¹£å¦‚æ­¤é‡è¦ï¼Ÿ**  
- **å®‰å…¨æ€§ï¼š** SHA-256 çš„åŠ å¯†å¼·åº¦ä½¿å¾—é€†å‘æˆ–ç¯¡æ”¹äº¤æ˜“è®Šå¾—ä¸å¯èƒ½ã€‚  
- **åŽ»ä¸­å¿ƒåŒ–ï¼š** æŒ–ç¤¦ç«¶çˆ­ç¢ºä¿æ²’æœ‰å–®ä¸€å¯¦é«”èƒ½æŽ§åˆ¶æ•´å€‹ç¶²çµ¡ã€‚  
- **é˜²ç¯¡æ”¹ï¼š** å€å¡Šéˆä¸­ä»»ä½•å¾®å°çš„ä¿®æ”¹éƒ½æœƒæ”¹è®Šé›œæ¹Šï¼Œä½¿æ¯”ç‰¹å¹£è®Šå¾—ä¸å¯è®Šã€‚

---

### **æ¯”ç‰¹å¹£çš„é›œæ¹Šå‡½æ•¸è¼¸å…¥æ˜¯ä»€éº¼ï¼Ÿ**  
æ¯”ç‰¹å¹£ç¤¦å·¥æœƒå°**å€å¡Šé ­**é€²è¡Œé›œæ¹Šï¼Œè©²å€å¡Šé ­åŒ…å«ï¼š  

| æ¬„ä½                 | å¤§å°   | æè¿°               |
|----------------------|--------|--------------------|
| **ç‰ˆæœ¬**             | 4 å­—ç¯€ | å€å¡Šæ ¼å¼ç‰ˆæœ¬       |
| **å‰å€å¡Šé›œæ¹Š**       | 32 å­—ç¯€ | å‰ä¸€å€å¡Šçš„é›œæ¹Š     |
| **Merkle æ¨¹æ ¹**      | 32 å­—ç¯€ | æ‰€æœ‰äº¤æ˜“çš„é›œæ¹Š     |
| **æ™‚é–“æˆ³**           | 4 å­—ç¯€ | ç•¶å‰æ™‚é–“ï¼ˆUnix æ™‚é–“æˆ³ï¼‰|
| **é›£åº¦ç›®æ¨™**         | 4 å­—ç¯€ | æŒ–ç¤¦çš„ç›®æ¨™å€¼       |
| **éš¨æ©Ÿæ•¸ (Nonce)**   | 4 å­—ç¯€ | ç”¨æ–¼å°‹æ‰¾æœ‰æ•ˆé›œæ¹Šçš„éš¨æ©Ÿæ•¸ |

ðŸ”¹ ç¤¦å·¥æœƒä¸æ–·æ”¹è®Š **éš¨æ©Ÿæ•¸** ç›´åˆ°å€å¡Šé ­çš„ SHA-256 é›œæ¹Š **ä½Žæ–¼ç›®æ¨™é›£åº¦**ã€‚  

---

## SHA-256 çš„éŽç¨‹

### **SHA-256 å¦‚ä½•è™•ç†æ•¸æ“šï¼Ÿ**  
SHA-256 é€šéŽ **ä¸€ç³»åˆ—æ•¸å­¸è®Šæ›** è™•ç†æ•¸æ“šï¼Œç”¢ç”Ÿ **å›ºå®š 256 ä½ï¼ˆ32 å­—ç¯€ï¼‰é›œæ¹Šå€¼**ã€‚ä»¥ä¸‹æ˜¯ SHA-256 é›œæ¹ŠéŽç¨‹çš„è©³ç´°æ­¥é©Ÿã€‚

---

## **SHA-256 çš„æ­¥é©Ÿæµç¨‹**
### **1. å°‡è¼¸å…¥è½‰æ›ç‚ºäºŒé€²åˆ¶**
- è¼¸å…¥ï¼ˆè¨Šæ¯ï¼‰é¦–å…ˆæœƒè½‰æ›ç‚º **äºŒé€²åˆ¶è¡¨ç¤º**ã€‚
- ä¾‹å¦‚ï¼ŒASCII æ–‡å­— **"hello"** è½‰æ›ç‚ºäºŒé€²åˆ¶ç‚ºï¼š

  ```
  01101000 01100101 01101100 01101100 01101111
  ```

---

### **2. å¡«å……è¨Šæ¯**
SHA-256 è¦æ±‚è¼¸å…¥é•·åº¦å¿…é ˆæ˜¯ **512 ä½ï¼ˆ64 å­—ç¯€ï¼‰çš„å€æ•¸**ã€‚å¦‚æžœè¼¸å…¥è¼ƒçŸ­ï¼Œå‰‡æœƒé€²è¡Œ **å¡«å……**ï¼š
- æ·»åŠ  **å–®å€‹ `1` ä½**ã€‚
- éš¨å¾Œæ·»åŠ ä¸€ç³»åˆ— **`0` ä½**ã€‚
- æœ€å¾Œ **64 ä½** å­˜å„²åŽŸå§‹è¨Šæ¯çš„é•·åº¦ã€‚

#### **ç¤ºä¾‹ï¼š**
- å‡è¨­åŽŸå§‹è¨Šæ¯æ˜¯ **"hello"**ï¼ˆ40 ä½ï¼‰ã€‚
- å¡«å……å¾Œé•·åº¦æœƒè®Šç‚º **512 ä½**ã€‚

---

### **3. å°‡è¨Šæ¯åˆ†æˆ 512 ä½å¡Š**
- å¡«å……å¾Œçš„è¨Šæ¯æœƒè¢« **åˆ†æˆ 512 ä½å¡Š**ã€‚
- å¦‚æžœè¨Šæ¯è¶…éŽ 512 ä½ï¼Œå‰‡æœƒè¢«åˆ†ç‚ºå¤šå€‹å¡Šï¼Œé€ä¸€è™•ç†ã€‚

---

### **4. åˆå§‹åŒ–é›œæ¹Šå€¼ï¼ˆ8 å€‹å¸¸æ•¸ï¼‰**
SHA-256 ä»¥ **å…«å€‹ 32 ä½çš„å›ºå®šé›œæ¹Šå€¼** é–‹å§‹ï¼ˆåå…­é€²åˆ¶è¡¨ç¤ºï¼‰ï¼š

```
h0 = 6a09e667
h1 = bb67ae85
h2 = 3c6ef372
h3 = a54ff53a
h4 = 510e527f
h5 = 9b05688c
h6 = 1f83d9ab
h7 = 5be0cd19
```

---

### **5. å‰µå»º 64 å€‹è¨Šæ¯è¨ˆåŠƒè©ž**
- 512 ä½çš„å€å¡Šæœƒè¢«æ“´å±•æˆ **64 å€‹è©ž**ï¼ˆæ¯å€‹ 32 ä½ï¼‰ã€‚
- å‰ **16 å€‹è©ž** ç›´æŽ¥ä¾†è‡ªè¨Šæ¯ã€‚
- å…¶é¤˜ **48 å€‹è©ž** æœƒé€šéŽä½æ“ä½œå’Œå‰é¢è©žçš„è¨ˆç®—ä¾†ç”Ÿæˆã€‚

---

### **6. é€²è¡Œ 64 è¼ªå£“ç¸®é‹ç®—**
SHA-256 æœƒåŸ·è¡Œ **64 è¼ªé‹ç®—**ï¼Œä½¿ç”¨ä½æ“ä½œã€æ¨¡ç®—è¡“å’Œé‚è¼¯å‡½æ•¸ã€‚

æ¯ä¸€è¼ªé‹ç®—æ¶‰åŠï¼š
- ä¸€çµ„ 64 å€‹å¸¸æ•¸å€¼ï¼ˆ`K[0]` åˆ° `K[63]`ï¼‰ï¼Œé€™äº›å¸¸æ•¸ä¾†è‡ªæ–¼å‰ 64 å€‹è³ªæ•¸çš„ç«‹æ–¹æ ¹ã€‚
- **ä½æ“ä½œ**ï¼ŒåŒ…æ‹¬æ—‹è½‰ã€ç•°æˆ–ï¼ˆXORï¼‰ã€èˆ‡ï¼ˆANDï¼‰å’Œæ¨¡åŠ æ³•ã€‚

æ¯ä¸€è¼ªéƒ½æœƒæ›´æ–°å…«å€‹é›œæ¹Šå€¼ï¼ˆ`h0` åˆ° `h7`ï¼‰ã€‚

---

### **7. æœ€çµ‚é›œæ¹Šå€¼**
- ç¶“éŽ 64 è¼ªé‹ç®—å¾Œï¼Œå…«å€‹é›œæ¹Šå€¼ï¼ˆ`h0` åˆ° `h7`ï¼‰æœƒèˆ‡ä¹‹å‰çš„é›œæ¹Šå€¼ç›¸åŠ ã€‚
- æœ€çµ‚çš„é›œæ¹Šå€¼æ˜¯å°‡ `h0` åˆ° `h7` é€²è¡Œ **ä¸²æŽ¥** å¾—åˆ°çš„ï¼ˆ256 ä½æˆ– 64 å€‹åå…­é€²åˆ¶å­—ç¬¦ï¼‰ã€‚

ä¾‹å¦‚ï¼š

```
SHA-256("hello") = 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824
```

---

## **ç¯„ä¾‹ï¼šPython ä¸­çš„ SHA-256**
ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ Python å…§å»ºçš„ `hashlib` ä¾†é›œæ¹Šä¸€å€‹å€¼ï¼š

```python
import hashlib

message = "hello".encode()  # å°‡è¨Šæ¯è½‰ç‚ºå­—ç¯€
hash_object = hashlib.sha256(message)  # è¨ˆç®— SHA-256 é›œæ¹Š
hash_hex = hash_object.hexdigest()  # è½‰æ›ç‚ºåå…­é€²åˆ¶

print(hash_hex)
```

### **è¼¸å‡ºï¼š**
```
2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824
```

---

## **ç‚ºä»€éº¼ SHA-256 æ˜¯å®‰å…¨çš„ï¼Ÿ**
1. **å–®å‘å‡½æ•¸** â†’ ä¸èƒ½é€†å‘é›œæ¹Šä¾†ç²å¾—åŽŸå§‹è¨Šæ¯ã€‚
2. **é›ªå´©æ•ˆæ‡‰** â†’ è¼¸å…¥ä¸­ä»»ä½•å¾®å°çš„è®ŠåŒ–éƒ½æœƒå¤§å¹…æ”¹è®Šé›œæ¹Šã€‚
3. **æŠ—ç¢°æ’žæ€§** â†’ å¾ˆé›£æ‰¾åˆ°å…©å€‹ä¸åŒçš„è¼¸å…¥ï¼Œç”¢ç”Ÿç›¸åŒçš„é›œæ¹Šã€‚

--- 

### ç°¡å–®çš„ Implementation

```python
# åˆå§‹åŒ–å·¥ä½œè®Šé‡
a, b, c, d, e, f, g, h = H

# ä¸»å¾ªç’°
for i in range(64):
    Î£1 = (e >> 6) ^ (e >> 11) ^ (e >> 25)
    Ch = (e & f) ^ (~e & g)
    temp1 = h + Î£1 + Ch + K[i] + W[i]
    Î£0 = (a >> 2) ^ (a >> 13) ^ (a >> 22)
    Maj = (a & b) ^ (a & c) ^ (b & c)
    temp2 = Î£0 + Maj

    h = g
    g = f
    f = e
    e = d + temp1
    d = c
    c = b
    b = a
    a = temp1 + temp2

# æ›´æ–°å“ˆå¸Œå€¼
H[0] += a
H[1] += b
H[2] += c
H[3] += d
H[4] += e
H[5] += f
H[6] += g
H[7] += h
```


