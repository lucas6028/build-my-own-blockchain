# Build My Own Blockchain

Tutorial URL: [Learn Blockchains by Building One](https://hackernoon.com/learn-blockchains-by-building-one-117428612f46)

## 比特幣技術基本介紹

比特幣的技術基於區塊鏈和去中心化網絡的概念，這些技術共同確保了比特幣的安全性、透明性和抗篡改性。以下是比特幣技術的幾個關鍵組成部分：

1. **區塊鏈（Blockchain）**：
   - 區塊鏈是一種分佈式帳本技術，所有比特幣交易都被記錄在一串連續的區塊中。每個區塊包含一組交易數據、時間戳和前一個區塊的哈希值，這樣每個區塊都依賴於前一個區塊，形成鏈式結構。
   - 這種結構確保了數據的不可篡改性，因為如果有人試圖修改某個區塊的內容，必須同時修改後續所有區塊，這在計算上是幾乎不可能的。

2. **去中心化網絡**：
   - 比特幣運行在一個分佈式的點對點網絡中，這意味著沒有中央伺服器或管理機構。所有的用戶（或節點）都可以參與區塊鏈的維護，並且每個節點都持有完整的區塊鏈副本。
   - 當有新交易發生時，這些交易會被廣播到整個網絡，並由網絡中的礦工進行驗證。

3. **挖礦（Mining）**：
   - 挖礦是比特幣創造和交易驗證的過程。礦工使用專門的計算機硬體來解決複雜的數學問題（例如SHA-256哈希函數）。
   - 成功解決問題的礦工會將新交易打包到一個新的區塊中，然後將其添加到區塊鏈上。作為獎勵，他們會獲得新生成的比特幣和交易手續費。

4. **共識機制（Consensus Mechanism）**：
   - 比特幣使用工作量證明（Proof of Work, PoW）作為其共識機制。這要求礦工在挖礦過程中投入計算能力，以確保只有經過驗證的交易才能被添加到區塊鏈上。
   - 這種機制能防止雙重支付和其他欺詐行為，因為攻擊者需要控制超過50%的計算能力才能影響網絡。

5. **私鑰和公鑰加密**：
   - 每個比特幣用戶都有一對密鑰：公鑰和私鑰。公鑰可以被用作比特幣地址，其他人可以用它來向你發送比特幣。私鑰則用於簽署交易，證明你對該比特幣的所有權。
   - 私鑰必須保密，因為擁有私鑰的人可以控制與該私鑰相關聯的比特幣。

6. **交易流程**：
   - 用戶發起交易時，會將交易資訊（如發送者的公鑰、接收者的公鑰和轉賬的比特幣數量）簽名並廣播到網絡中。
   - 礦工驗證這些交易的有效性，確保發送者有足夠的比特幣並且交易未被重複使用。有效的交易將被打包到區塊中並添加到區塊鏈上。

---

## 比特幣的 PoW (Proof of Work)

在 sample code 當中的 PoW 是找一個 `y` 使得 `x * y` 經過 SHA-256 後的結果開頭為 4 個 0，所以 `y` 有多種符合的值。在比特幣挖礦的過程中，礦工是找一個 *nonce* (特殊數字)。

- **挖礦者必須找到一個 nonce**，使得區塊標頭的 SHA-256 值以一定數量的 0 開頭 (越多的 0 代表難度越高)
- 挖礦的難度會根據居快發現的速度動態調整
這個過程稱為 **工作量證明 (PoW)**

PoW 工作量證明英文全名為 Proof-of-Work，是全世界最早誕生的共識機制，也是比特幣（BTC）、萊特幣（LTC）、狗狗幣（DOGE）等早期區塊鏈所使用的共識機制。

PoW 機制的參與者稱為礦工（Miner），嘗試獲得獎勵的過程稱作挖礦（Mining）。PoW 挑選記帳者的方式是讓礦工們為一道困難的數學題計算出答案，**最先解出答案者，即獲得打包新區塊的資格，並獲得加密貨幣作為獎勵**。

值得一提的是，這道數學題的答案只能用「猜」的，礦工需要貢獻電腦算力嘗試猜出這個「隨機答案」。然而就算礦工擁有的運算能力再強大，至多只能提高猜中的可能性；也就是說，**算力差的礦工也有搶答成功並獲得挖礦獎勵的機會**。這使得 PoW 工作量證明擁有極高的去中心化程度與安全性，令其他共識機制望塵莫及。

然而，PoW 共識機制也有較難克服的缺點，比如為了確保區塊鏈的安全性，每一位礦工在驗證完區塊上的交易紀錄後，還必須耗費算力完成數學題目來爭取記帳權，不僅造成交易速度（出塊時間）緩慢，在挖礦過程中消耗的大量電力也有可能對環境造成負面影響。

![alt text](https://github.com/lucas6028/build-my-own-blockchain/blob/main/assets/images/pow.jpg)

---

## 共識機制 PoS 權益證明是什麼？
PoS 權益證明英文全名為 Proof-of-Stake，目的是改善 PoW 工作量證明耗費電力且傳輸速度慢的缺點，以太坊（ETH）、Cardano（ADA）區塊鏈皆使用 PoS 權益證明共識機制。

PoS 機制的參與者稱為驗證者（Validators），嘗試獲得獎勵的過程稱為質押（Staking）。PoS 挑選記帳者的方式，是要求驗證者將加密貨幣鎖定於該區塊鏈上（質押），**若質押的加密貨幣越多、質押的時間越長、距離成為記帳者的時間越久，被區塊鏈隨機選中成為記帳者的機率就越高**。  

若區塊鏈發現 PoS 驗證者進行惡意行為（批准無效交易），將會把驗證者鎖定的加密貨幣全數扣除作為懲罰（Slashing），以維持「誠實者比作惡者更有利有圖」的原則。

由於質押越多加密貨幣代表更容易獲得加密貨幣獎勵，**讓 PoS 比起 PoW 更存在著「大者恆大」的疑慮**，因此其去中心化程度可能較 PoW 低。另外，在驗證者不夠分散的情況下，很容易因為駭客攻擊導致該區塊鏈產生系統性風險，**所以 PoS 權益證明的安全性通常不如 PoW 工作量證明來得高**。

![alt text](https://github.com/lucas6028/build-my-own-blockchain/blob/main/assets/images/pos.jpg)

---

### **比特幣如何找到正確的答案？**
比特幣挖礦者會不斷調整 **nonce** 值，直到找到一個符合要求的哈希值。

#### **比特幣挖礦過程（簡化）**
1. **創建區塊標頭**  
   **區塊標頭** 包含：
   - 前一個區塊哈希
   - 時戳 (timestamp)
   - Merkle 根（所有交易的哈希）
   - 難度目標
   - **Nonce**（要找的值！）

2. **計算 SHA-256 哈希值**  
   - 挖礦者計算：
     ```python
     block_hash = sha256(sha256(block_header).digest()).hexdigest()
     ```
   - 比特幣使用 **雙重 SHA-256** 哈希算法。

3. **檢查哈希是否符合目標**  
   - 哈希值必須 **小於難度目標**。
   - 例如目標：`0000000000000000000abcd123...`
   - 如果哈希不符合條件，則挖礦者會增加 **nonce** 並再次嘗試。

4. **重複直到找到有效哈希**  
   - 第一個找到有效 nonce 的挖礦者會 **廣播** 區塊到網絡。
   - 其他挖礦者 **驗證** 它。
   - 如果有效，區塊會被添加到區塊鏈中，並且該挖礦者會獲得 **比特幣獎勳**。

---

## Reference
- [ChatGPT](https://chatgpt.com/)
- [鏈習生 - 區塊鏈的靈魂：3 大共識機制是什麼？為什麼需要挖礦？PoW 是什麼？PoS 是什麼？NPoS 是什麼？](https://chainee.io/what-is-consensus-in-blockchain/)

