# Build My Own Blockchain

Tutorial URL: [Learn Blockchains by Building One](https://hackernoon.com/learn-blockchains-by-building-one-117428612f46)

## 比特幣技術基本介紹

比特幣的技術基於區塊鏈和去中心化網絡的概念，這些技術共同確保了比特幣的安全性、透明性和抗篡改性。以下是比特幣技術的幾個關鍵組成部分：

1. **區塊鏈（Blockchain）**：
   - 區塊鏈是一種分佈式帳本技術，所有比特幣交易都被記錄在一串連續的區塊中。每個區塊包含一組交易數據、時間戳和前一個區塊的哈希值，這樣每個區塊都依賴於前一個區塊，形成鏈式結構。
   - 這種結構確保了數據的不可篡改性，因為如果有人試圖修改某個區塊的內容，必須同時修改後續所有區塊，這在計算上是幾乎不可能的。

2. **去中心化網絡**：
   - 比特幣運行在一個分佈式的點對點網絡中，這意味著沒有中央伺服器或管理機構。所有的用戶（或節點）都可以參與區塊鏈的維護，並且每個節點都持有完整的區塊鏈副本。
   - 當有新交易發生時，這些交易會被廣播到整個網絡，並由網絡中的礦工進行驗證。

3. **挖礦（Mining）**：
   - 挖礦是比特幣創造和交易驗證的過程。礦工使用專門的計算機硬體來解決複雜的數學問題（例如SHA-256哈希函數）。
   - 成功解決問題的礦工會將新交易打包到一個新的區塊中，然後將其添加到區塊鏈上。作為獎勵，他們會獲得新生成的比特幣和交易手續費。

4. **共識機制（Consensus Mechanism）**：
   - 比特幣使用工作量證明（Proof of Work, PoW）作為其共識機制。這要求礦工在挖礦過程中投入計算能力，以確保只有經過驗證的交易才能被添加到區塊鏈上。
   - 這種機制能防止雙重支付和其他欺詐行為，因為攻擊者需要控制超過50%的計算能力才能影響網絡。

5. **私鑰和公鑰加密**：
   - 每個比特幣用戶都有一對密鑰：公鑰和私鑰。公鑰可以被用作比特幣地址，其他人可以用它來向你發送比特幣。私鑰則用於簽署交易，證明你對該比特幣的所有權。
   - 私鑰必須保密，因為擁有私鑰的人可以控制與該私鑰相關聯的比特幣。

6. **交易流程**：
   - 用戶發起交易時，會將交易資訊（如發送者的公鑰、接收者的公鑰和轉賬的比特幣數量）簽名並廣播到網絡中。
   - 礦工驗證這些交易的有效性，確保發送者有足夠的比特幣並且交易未被重複使用。有效的交易將被打包到區塊中並添加到區塊鏈上。

---

### **比特幣如何找到正確的答案？**
比特幣挖礦者會不斷調整 **nonce** 值，直到找到一個符合要求的哈希值。

#### **比特幣挖礦過程（簡化）**
1. **創建區塊標頭**  
   **區塊標頭** 包含：
   - 前一個區塊哈希
   - 時戳 (timestamp)
   - Merkle 根（所有交易的哈希）
   - 難度目標
   - **Nonce**（要找的值！）

2. **計算 SHA-256 哈希值**  
   - 挖礦者計算：
     ```python
     block_hash = sha256(sha256(block_header).digest()).hexdigest()
     ```
   - 比特幣使用 **雙重 SHA-256** 哈希算法。

3. **檢查哈希是否符合目標**  
   - 哈希值必須 **小於難度目標**。
   - 例如目標：`0000000000000000000abcd123...`
   - 如果哈希不符合條件，則挖礦者會增加 **nonce** 並再次嘗試。

4. **重複直到找到有效哈希**  
   - 第一個找到有效 nonce 的挖礦者會 **廣播** 區塊到網絡。
   - 其他挖礦者 **驗證** 它。
   - 如果有效，區塊會被添加到區塊鏈中，並且該挖礦者會獲得 **比特幣獎勳**。

---

### 記憶池 (Mempool)
**Mempool（記憶池）** 是 **未確認比特幣交易的臨時儲存空間**。它存在於 **每個比特幣完整節點內**，而不是作為單一資料庫。

✅ 每個完整節點都有 **自己的記憶池**，其中包含待處理的交易。  
✅ 交易會留在記憶池中，**直到礦工將它們包含在區塊中**。  
✅ 一旦交易被 **礦工挖入區塊**，它會 **從所有記憶池中移除**。

### **Mempool 是資料庫嗎？**  
🔹 **不，記憶池不是全球資料庫。**  
🔹 每個比特幣節點將交易儲存在 **RAM（記憶體）** 中。  
🔹 不同的節點可能會因為網路延遲、交易費用和本地設置等原因而有 **稍微不同的記憶池**。

---

### **交易如何進入並儲存在記憶池中？**  
#### **1️⃣ 用戶創建交易**
- 一個比特幣錢包（如 Electrum、Ledger 或 Bitcoin Core）會生成一筆 **交易**。  
- 交易包含：  
  - 輸入（被花費的先前 UTXO）  
  - 輸出（接收者地址 + 金額）  
  - 數位簽名（證明比特幣的所有權）  
  - **交易費用**（礦工的激勳）  

#### **2️⃣ 交易廣播到網絡**
- 錢包將交易 **發送** 到一個比特幣 **完整節點**（通過點對點網絡）。  
- 節點 **驗證** 該交易：  
  ✅ 輸入是否 **未被花費**？  
  ✅ 簽名是否與發送者的私鑰匹配？  
  ✅ 發送者是否擁有足夠的比特幣？  
  ✅ 交易結構是否有效？

#### **3️⃣ 交易進入記憶池**
- 如果交易有效，節點會 **儲存** 該交易於其 **記憶池** 中。  
- 節點會 **廣播** 該交易到 **其他完整節點**。  
- 其他節點會重複這個過程並更新它們的記憶池。

#### **4️⃣ 礦工從記憶池中選擇交易**
- 礦工從他們 **自己的記憶池** 中選擇交易，優先選擇 **高費用交易**。  
- 選中的交易會組成一個 **新的候選區塊**。  
- 礦工嘗試 **找到有效的隨機數**，以解決工作量證明（PoW）。

#### **5️⃣ 交易被確認並從記憶池中移除**
- 一旦礦工找到有效的哈希，區塊會被 **廣播** 到網絡中。  
- 完整節點會 **驗證** 該區塊並將其加入區塊鏈。  
- 區塊中的交易會 **從所有記憶池中移除**。

___

### **如果所有記憶池都滿了，會發生什麼事？**  
如果所有記憶池達到 **最大容量**：  
1️⃣ **最低費用的交易會被丟棄**（不會儲存到記憶池中）。  
2️⃣ 這些交易 **不會被包含在任何區塊** 中，除非重新廣播並附上更高的費用。  
3️⃣ 用戶可以使用 **Replace-By-Fee（RBF）** 重新發送交易並附上更高的費用。

💡 **範例情境**：  
- 一個節點的記憶池限制為 **300 MB**。  
- 如果記憶池滿了，新的 **低費用交易** 會被 **拒絕**。  
- 高費用交易仍然會被 **接受**。

### **如何避免交易被丟棄？**  
✅ 用戶可以在發送前 **增加交易費用**。  
✅ 使用 **RBF（Replace-By-Fee）** 來將低費用交易替換為高費用交易。  
✅ 等待 **記憶池擁塞解除**（當礦工處理待處理交易時）。

---

### **如果長時間沒有交易或所有交易都已被挖掘會怎麼樣？**  
如果 **很少或根本沒有交易** 持續很長一段時間：  
✅ 礦工仍會繼續挖掘 **空區塊** 來領取區塊獎勳。  
✅ 比特幣的 **挖礦難度會下降**，使挖礦變得更容易。  
✅ 網絡仍然保持運行，但區塊大多會是空的。

🔴 **但：** 如果沒有礦工存在，比特幣就會停止運作（不會有新區塊產生）。

---

## Reference
- [ChatGPT](https://chatgpt.com/)
- [鏈習生 - 區塊鏈的靈魂：3 大共識機制是什麼？為什麼需要挖礦？PoW 是什麼？PoS 是什麼？NPoS 是什麼？](https://chainee.io/what-is-consensus-in-blockchain/)

